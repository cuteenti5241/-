document.addEventListener('DOMContentLoaded', function() {
    // ë‹¤í¬/ë¼ì´íŠ¸ ëª¨ë“œ ì „í™˜
    document.getElementById("themeToggle").addEventListener("click", function(event) {
        event.preventDefault();
        const bodyClass = document.body.classList;
        if (bodyClass.contains("dark-mode")) {
            bodyClass.remove("dark-mode");
            bodyClass.add("light-mode");
            document.getElementById("themeToggle").textContent = "â˜€ï¸ ë¼ì´íŠ¸ëª¨ë“œ";
        } else {
            bodyClass.remove("light-mode");
            bodyClass.add("dark-mode");
            document.getElementById("themeToggle").textContent = "ğŸŒ™ ë‹¤í¬ëª¨ë“œ";
        }
    });

    // ì„¹ì…˜ì„ í‘œì‹œí•˜ëŠ” í•¨ìˆ˜
    function showSection(sectionId) {
        const sections = document.querySelectorAll('main section');
        sections.forEach(section => {
            section.style.display = 'none';
        });
        document.getElementById(sectionId).style.display = 'block';
    }

    // URL ìƒíƒœë¥¼ ê¸°ë°˜ìœ¼ë¡œ ì„¹ì…˜ ì „í™˜
    function handleNavigation() {
        const url = new URL(window.location);
        const section = url.searchParams.get('section') || 'main-image';
        showSection(section);
    }

    // ë©”ë‰´ ë§í¬ í´ë¦­ ì´ë²¤íŠ¸
    document.getElementById("mainLink").addEventListener("click", function(event) {
        event.preventDefault();
        navigateToSection('main-image');
    });

    document.getElementById("worksLink").addEventListener("click", function(event) {
        event.preventDefault();
        navigateToSection('works-section');
    });

    document.getElementById("infoLink").addEventListener("click", function(event) {
        event.preventDefault();
        navigateToSection('info-section');
    });

    document.getElementById("downloadsLink").addEventListener("click", function(event) {
        event.preventDefault();
        navigateToSection('downloads-section');
    });

    document.getElementById("boardLink").addEventListener("click", function(event) {
        event.preventDefault();
        navigateToSection('board-section');
    });

    document.getElementById("questionsLink").addEventListener("click", function(event) {
        event.preventDefault();
        navigateToSection('questions-section');
    });

    document.getElementById("mypageLink").addEventListener("click", function(event) {
        event.preventDefault();
        navigateToSection('mypage-section');
    });

    // URL ìƒíƒœì— ë”°ë¼ ì„¹ì…˜ ì „í™˜
    function navigateToSection(sectionId) {
        const url = new URL(window.location);
        url.searchParams.set('section', sectionId);
        history.pushState({ section: sectionId }, '', url);
        showSection(sectionId);
    }

    // ë¸Œë¼ìš°ì € ë’¤ë¡œ/ì•ìœ¼ë¡œ ê°€ê¸° ë²„íŠ¼ í´ë¦­ ì‹œ
    window.addEventListener('popstate', function(event) {
        if (event.state && event.state.section) {
            showSection(event.state.section);
        } else {
            showSection('main-image');
        }
    });

    // ì´ˆê¸° í˜ì´ì§€ ë¡œë“œ ì‹œ ì„¹ì…˜ ì²˜ë¦¬
    handleNavigation();

    // ë¡œê·¸ì¸ ë° íšŒì›ê°€ì… ê¸°ëŠ¥
    const users = {}; // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì— ì €ì¥ëœ ì‚¬ìš©ì ë°ì´í„°

    document.getElementById("showSignup").addEventListener("click", function(event) {
        event.preventDefault();
        document.getElementById("login-section").style.display = "none";
        document.getElementById("signup-section").style.display = "block";
    });

    document.getElementById("showLogin").addEventListener("click", function(event) {
        event.preventDefault();
        document.getElementById("signup-section").style.display = "none";
        document.getElementById("login-section").style.display = "block";
    });

    document.getElementById("loginForm").addEventListener("submit", function(event) {
        event.preventDefault();
        const username = document.getElementById("loginUsername").value;
        const password = document.getElementById("loginPassword").value;

        if (users[username] && users[username].password === password) {
            localStorage.setItem('loggedInUser', username);
            updateUserInfo();
            navigateToSection('mypage-section');
        } else {
            alert("ì˜ëª»ëœ ì‚¬ìš©ì ì´ë¦„ ë˜ëŠ” ë¹„ë°€ë²ˆí˜¸ì…ë‹ˆë‹¤.");
        }
    });

    document.getElementById("signupForm").addEventListener("submit", function(event) {
        event.preventDefault();
        const username = document.getElementById("signupUsername").value;
        const password = document.getElementById("signupPassword").value;

        if (!users[username]) {
            users[username] = { password: password };
            localStorage.setItem('users', JSON.stringify(users));
            alert("íšŒì›ê°€ì…ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.");
            document.getElementById("signup-section").style.display = "none";
            document.getElementById("login-section").style.display = "block";
        } else {
            alert("ì´ë¯¸ ì¡´ì¬í•˜ëŠ” ì‚¬ìš©ì ì´ë¦„ì…ë‹ˆë‹¤.");
        }
    });

    document.getElementById("logoutBtn").addEventListener("click", function() {
        localStorage.removeItem('loggedInUser');
        navigateToSection('mypage-section');
    });

    function updateUserInfo() {
        const username = localStorage.getItem('loggedInUser');
        if (username) {
            document.getElementById("usernameDisplay").textContent = username;
            document.getElementById("login-section").style.display = "none";
            document.getElementById("signup-section").style.display = "none";
            document.getElementById("user-info").style.display = "block";
        } else {
            document.getElementById("login-section").style.display = "block";
            document.getElementById("signup-section").style.display = "none";
            document.getElementById("user-info").style.display = "none";
        }
    }

    // ë¡œê·¸ì¸ ìƒíƒœì— ë”°ë¼ ì‚¬ìš©ì ì •ë³´ ì—…ë°ì´íŠ¸
    updateUserInfo();
});
